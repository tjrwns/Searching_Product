var fileNm = "dbjs/_CATEGORY.SITE/allList__byCountry.dbjs";
Rh2Log.log( "-- [ S ] - " + fileNm );

//----------------------------------------------------------------------------------------------------;

Rh2Log.log( "-- 요약 : 나라별 사이트 개수 및 목록 조회" );
Rh2Log.log( "----------" );
Rh2Log.log( "-- 입력데이터 : NaN" );
Rh2Log.log( "----------" );
Rh2Log.log( "-- 전제조건 : _CATEGORY.SITE, _CATEGORY.COUNTRY 존재" );
Rh2Log.log( "----------" );
Rh2Log.log( "-- 예상결과 : _CATEGORY.SITE, _CATEGORY.COUNTRY 를 조회하여 목록 반환" );

//----------------------------------------------------------------------------------------------------;

//To Get Execution Time;
var _ST = Date.now()

//----------------------------------------------------------------------------------------------------;

//	REQUIRE;

//----------------------------------------------------------------------------------------------------;

//----------------------------------------------------------------------------------------------------;

//	FUNCTION;

//----------------------------------------------------------------------------------------------------;

//----------------------------------------------------------------------------------------------------;

//	DATABASE;

//----------------------------------------------------------------------------------------------------;

var _db$_CATEGORY = db.getSiblingDB( "_CATEGORY" );

//----------------------------------------------------------------------------------------------------;

//	COLLECTION;

//----------------------------------------------------------------------------------------------------;

var _col$COUNTRY = _db$_CATEGORY.getCollection( "COUNTRY" );
var _col$SITE = _db$_CATEGORY.getCollection( "SITE" );

//----------------------------------------------------------------------------------------------------;

//	DOCUMENT;

//----------------------------------------------------------------------------------------------------;

var _doc$COUNTRY;

//----------------------------------------------------------------------------------------------------;

//	PARAMETER;

//----------------------------------------------------------------------------------------------------;

var _p_find__country = { cd : "" };
var _p_find__site = {
	_d : 1
	, cd$COUNTRY : ""
};
var R = {};

//----------------------------------------------------------------------------------------------------;

//	VALIDATION;

//----------------------------------------------------------------------------------------------------;

//----------------------------------------------------------------------------------------------------;

//	LOGIC;

//----------------------------------------------------------------------------------------------------;

var result = [];
var totalCount = 0;
//사이트 데이터에서 중복 제거된 나라코드 배열;
var _a_country = _col$SITE.distinct( "cd$COUNTRY" );

var i=0, iLen=_a_country.length;
var io;//_a_country[ i ];
for( ; i<iLen; ++i )
{
	io = _a_country[ i ];

	_p_find__country.cd = io;
	_doc$COUNTRY = _col$COUNTRY.findOne( _p_find__country );

	//if( _doc$COUNTRY )
	//{
		_doc$COUNTRY.a_site = [];
		_p_find__site.cd$COUNTRY = io;
		_col$SITE.find( _p_find__site ).forEach( function( doc ){
			_doc$COUNTRY.a_site.push( doc );
		});
		_doc$COUNTRY.cnt = _doc$COUNTRY.a_site.length;
		totalCount += _doc$COUNTRY.cnt;

		result.push( _doc$COUNTRY );
	//}
}

//----------------------------------------------------------------------------------------------------;

R.r = 0;
R.m = "OK";
R.data = result;
R.totalCount = totalCount;
//R.executionTime = Date.now() - _ST;

Rh2Log.log( "-- [ E ] - " + fileNm );

return R;
