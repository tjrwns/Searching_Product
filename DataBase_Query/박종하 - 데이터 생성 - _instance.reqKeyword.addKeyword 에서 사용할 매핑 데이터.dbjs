var fileNm = "js__b2link__SYS0310/b2link_router_external/reqKeyword/crud/addKeyword.dbjs";
RayLog.log( "---- [ S ] - " + fileNm );

//----------------------------------------------------------------------------------------------------;

RayLog.log( "-- 요약 : 키워드 검색 - 추가 사이트 사전 생성" );
RayLog.log( "----------" );
RayLog.log( '-- 입력데이터 : null' );
RayLog.log( "----------" );
RayLog.log( "-- 전제조건 : CATEGORY.SITE에 cd$COUNTRY와 사용여부 d 가 선언되어 있다. " );
RayLog.log( "----------" );
RayLog.log( "-- 예상결과 : _instance.reqKeyword.addKeyword 에 데이터가 삽입된다." );

//----------------------------------------------------------------------------------------------------;

//To Get Execution Time;
var _ST = Date.now();

//----------------------------------------------------------------------------------------------------;

//	REQUIRE;

//----------------------------------------------------------------------------------------------------;

//----------------------------------------------------------------------------------------------------;


//	FUNCTION;
//----------------------------------------------------------------------------------------------------;

//----------------------------------------------------------------------------------------------------;

//	DATABASE;

//----------------------------------------------------------------------------------------------------;

var _db$_CATEGORY = db.getSiblingDB( "_CATEGORY" );
var _db$_instance = db.getSiblingDB( "_instance" );

//----------------------------------------------------------------------------------------------------;

//	COLLECTION;

//----------------------------------------------------------------------------------------------------;

var _col$SITE = _db$_CATEGORY.getCollection( "SITE" );
var _col$reqKeyword = _db$_instance.getCollection( "reqKeyword" );

//----------------------------------------------------------------------------------------------------;

//	DOCUMENT;

//----------------------------------------------------------------------------------------------------;

var _doc$SITE;

//----------------------------------------------------------------------------------------------------;

//	PARAMETER;

//----------------------------------------------------------------------------------------------------;


var R = {};

var map = {
	_id : "addKeyword"
	, data : {
	"CN" : []
	, "JP" : []
	, "KR" : []
	, "US" : []
	}
};


//----------------------------------------------------------------------------------------------------;

//	LOGIC;

//----------------------------------------------------------------------------------------------------;

var _fn = {
    KR : undefined
    , US : undefined
    , JP : undefined
    , CN : undefined};
_fn.KR = function( cd ){
	map.data[ "KR" ].push( cd );
	map.data[ "US" ].push( cd );
};

_fn.US = function ( cd ) {
	map.data[ "US" ].push( cd );
};

_fn.CN = function ( cd ) {
	map.data[ "CN" ].push( cd );
    map.data[ "JP" ].push( cd );
	map.data[ "US" ].push( cd );
};

_fn.JP = function ( cd ) {
	map.data[ "CN" ].push( cd );
	map.data[ "JP" ].push( cd );
	map.data[ "US" ].push( cd );
};


_col$SITE.find( { _d : 1 }, { _id : 0, cd$COUNTRY : 1, cd : 1} ).forEach( function( doc )  {

    	if( doc.cd$COUNTRY == "KR") _fn[ "KR" ]( doc.cd );
        else if( doc.cd$COUNTRY == "JP") _fn[ "JP" ]( doc.cd );
        else if( doc.cd$COUNTRY == "CN") _fn[ "CN" ]( doc.cd );
        else _fn[ "US" ]( doc.cd );


} );

//기존것은 삭제하고 삽입;
_col$reqKeyword.remove({ _id : map._id } )
_col$reqKeyword.insert( map ) ;
